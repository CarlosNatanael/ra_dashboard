{% extends "layout.html" %}

{% block title %}
    Review Queue - RA Dashboard
{% endblock %}

{% block content %}
    <h2>Global Review Queue (Jr. Dev View)</h2>

    <form method="get" action="/" style="display: inline-block;">
        <label for="search">Search Game/Dev:</label>
        <input type="text" id="search" name="search" value="{{ search_term or '' }}">
        <button type="submit">Search</button>
        <a href="/">Clear Filters</a>
    </form>
    <table>
        <thead>
            <tr>
                <th>Game (ID)</th>
                <th>Junior Developer</th>
                <th>Date Requested</th>
                <th>Last Updated</th>
                <th>Status</th>
                <th>Reviewer</th>
            </tr>
        </thead>
        <tbody id="queue-body">
            {% include '_queue_table.html' %}
        </tbody>
    </table>

    <script>
        function updateQueue() {
            const searchTerm = document.getElementById('search').value;
            const mySetsFilter = document.getElementById('my_sets').value;
            const apiUrl = `/api/update-queue?search=${encodeURIComponent(searchTerm)}&my_sets=${encodeURIComponent(mySetsFilter)}`;

            fetch(apiUrl)
                .then(response => response.text())
                .then(html => {
                    document.getElementById('queue-body').innerHTML = html;
                })
                .catch(err => console.error('Error updating queue:', err));
        }
        setInterval(updateQueue, 30000);
    </script>
{% endblock %}