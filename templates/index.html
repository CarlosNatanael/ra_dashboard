{% extends "layout.html" %}

{% block title %}
    Fila de Revisão - RA Dashboard
{% endblock %}

{% block content %}
    <h2>Fila de Revisão Global (Visão do Jr. Dev)</h2>

    <form method="get" action="/" style="display: inline-block;">
        <label for="search">Buscar Jogo/Dev:</label>
        <input type="text" id="search" name="search" value="{{ search_term or '' }}">
        <button type="submit">Buscar</button>
        <a href="/">Limpar Filtros</a>
    </form>
    <table>
        <thead>
            <tr>
                <th>Jogo (ID)</th>
                <th>Desenvolvedor</th>
                <th>Data Pedido</th>
                <th>Última Atualização</th>
                <th>Status</th>
                <th>Revisor</th>
            </tr>
        </thead>
        <tbody id="queue-body">
            {% include '_queue_table.html' %}
        </tbody>
    </table>

    <script>
        function updateQueue() {
            const searchTerm = document.getElementById('search').value;
            const mySetsFilter = document.getElementById('my_sets').value;
            const apiUrl = `/api/update-queue?search=${encodeURIComponent(searchTerm)}&my_sets=${encodeURIComponent(mySetsFilter)}`;

            fetch(apiUrl)
                .then(response => response.text())
                .then(html => {
                    document.getElementById('queue-body').innerHTML = html;
                })
                .catch(err => console.error('Erro ao atualizar fila:', err));
        }
        setInterval(updateQueue, 30000);
    </script>
{% endblock %}